## GDB调试技巧整理
### 写在前面 ###
最近工作中在进行C语言主机进程相关的开发工作，相关开发工作不依赖与IDE进行，编译环境和运行环境分离（编译是在独立的编译机上进行，编译产生bin文件之后再拿到运行环境中进行使用）。

好的调试工具对于整个开发过程而言是有着非常重要的意义的，它就像人类的眼睛一样，可以让开发者清楚的了解到程序的运行情况。而对于C语言的调试而言，GDB工具是非常实用的工具，也是非常基础的手段。本文在基于之前网友的整理，并结合自己的认识，进行相关的整理，以期做自我总结，并做到对大家的工作有所帮助。

#### GDB的基础认识

GDB的主要功能集中在如下四个方面：

1. 启动程序
2. 使程序在指定的位置断点
3. 当程序被停住后，检查程序中所发生的事
4. 当程序bug时，修改bug产生的影响，继续测试

#### GDB的基础命令

> 程序启动

- gdb ``<program>``
    
    其中program就是程序的可执行文件，默认是当前路径，也可以全路径指定
    
- gdb ``<program>`` core

    同时调试运行的程序和core文件，core文件是程序运行异常后coredump的文件  
- gdb ``<program>`` ``<PID>`` 

    program代表系统的一个进程，PID是其进程号。这种方式下gdb会自动attach附着上去并进行调试。其中program应该能够在系统的环境变量中搜索到，或者将program进行全路径指定
    > 对于已经进行的进程的调试，我们也可以通过
    
    > gdb  进入程序的gdb调试
    
    > attach ``<PID> `` 完成调试过程向指定PID的绑定

       
> 程序启动信息设置

- 设置启动参数

     set args 可指定运行时参数。（如：set args 10 20 30 40 50）
- 设置运行环境
     
     设置程序的运行路径: path ``<dir>``  (可以通过show paths 查看) 

     设置环境变量： set environment varname [=value] （可以通过show environment [varname]查看）
- 设置工作目录

     cd ``<dir>`` 
- 设置程序的输入输出

     info terminal 显示你程序用到的终端的模式
      
     使用重定向控制程序输出。如：run > outfile
   
> 断点

  > 断点设置的关键词是break,可以缩写为b，后文统一使用缩写

- 断点的设置

   - b ``<function>`` 在指定的函数位置增加断点
   - b ``<filename>`` ``<linenum>`` 在指定文件的对应行号增加点
   - b +offset / -offset 在当前行号前面/后面offset行增加断点
   - b ... if <condition> 当条件成立时断住，如循环体中设置break if i==100
   
- 断点的删除

   - clear 删除程序中的所有断点
   - clear ``<linenum>`` 删除这行对应的断点
   - clear ``<function>`` 删除该函数的断点
   - delete ``<b_id1 b_id2>`` 删除指定编号的多个断点
   
 
- 断点的查看

   - info break [n] ；n可选，表示断点号
   
- 断点的运行
   - next ``<count>`` 单步运行， 缩写为n
   - step ``<count>`` 单步跟踪，如果有函数调用，则进入。 缩写为s
   - continue 继续运行，所谓为c

> 程序运行信息查看

- 查看源程序  *对于进程直接调试的场景，无法反编译获得对应的源码文件，只能显示当前在哪个文件的哪一行*

   - list ``<linenum>`` 显示行号周围的源码
   - list ``<function>`` 显示指定函数的源码
 
- 查看运行时数据
   - print ``<expr>`` 显示表达式对应的信息 
   - print ``/<f>`` ``<expr>`` 按照指定的格式输出表达式信息
- 查看栈信息
   - backtrace （或bt） 打印当前的函数调用栈的所有信息
   - info args 打印当前函数的参数名及其值
   - info locals 打印当前函数的所有局部变量及其值
> 改变程序的执行

- 修改变量值  

   - print var=``<val>``修改变量var的值为val
- 跳转执行

   - jump ``<linespec>`` 指定下一条语句的执行点，可以通过filename:linenum的形式，也可以通过+num这种偏移量的形式
 
- 产生信号量

   - signal <singal> 产生一个信号量给调试的程序
- 强制函数返回 

   - return 强制当前函数返回
   - return ``<expr>`` 强制当前函数以表达式结果作为返回值返回

> GDB调试多线程技巧

- 显示当前可调试的所有线程
   - info threads 
   - 每个线程GDB都会为其分配一个ID，前面标记有*的表示当前调试线程
- 线程切换
   - thread ID
- 在所有线程中相应的行上设置断点
   - break thread_test.c:123 thread all 
- 让一个或者多个线程执行GDB命令command
   - thread apply ID1 ID2 command 
   - thread apply all command 让所有线程都执行GDB的command命令
- set scheduler-locking off|on|step
   - 背景：在使用step或者continue命令调试当前被调试线程的时候，其他线程也是同时执行的，多个线程的执行结果混合在一起，非常不方便分析
   - off： 不锁定任何线程，也就是所有线程都执行，这是默认值
   - on：只有当前被调试程序会执行
   - step： 在单步的时候，除了next过一个函数的情况以外，只有当前线程会执行	  

####本文参考
1. [用GDB调试程序]: http://wiki.ubuntu.org.cn/index.php?title=%E7%94%A8GDB%E8%B0%83%E8%AF%95%E7%A8%8B%E5%BA%8F&variant=zh-cn
2. [Linux gdb设置和管理断点]: http://www.cnblogs.com/rosesmall/archive/2012/04/13/2445527.html